# Latest service_spec.yml file can be obtained from https://git.corp.adobe.com/adobe-platform/service-spec/blob/master/spec.yaml

service_name: vectordbservice

# Operational
# Service Code is code generated by 'Atlas service registry' for your service. To generate one, go to https://atlas.adobe.io
# Read more about how to create an Atlas service code here: https://wiki.corp.adobe.com/x/N4O1ag
service_code: null

# Specify the owner of the service. Required for CCF compliance.

adobe_owner: Cloud Technology


# Possible values are: Public, Internal, Confidential, Restricted.
data_classification: [Public]

#How to obtain correct cost center for your service: https://wiki.corp.adobe.com/display/ethos/OrCA+-+Cost+Center
adobe_cost_centers:
  # Mandatory if Dev or Stage environment is present
  # ADUS cost center is required in case of opex (Operational Expense)
  opex:
    # ADUS cost center (US-based)
    adus: 103892
  # Mandatory if Prod environment is present.
  # Both ADUS and ADIR cost centers are required in case of cogs (Cost of Goods Sold)
  cogs:
    # ADUS cost center (US-based)
    adus: 103892
    # ADIR cost center (Ireland-based)
    adir: 5488937

alerts:
  # Used to send the notification mails to the given list of IDs.
  # Accepts an array of email IDs.
  # At least one email ID is mandatory. Required for CCF compliance.
  emails: [anisingh@adobe.com]

monitoring:
  # Mandatory.
  # Unique name, will be used as monitoring app name.

  # prometheus monitoring integration
  - name: vectordbservice-qa
    type: Ethos-NMS
    default: true
    monitoring_spec:
      path: ".ethos/monitoring_spec_qa.yml"
  - name: vectordbservice-stg
    type: Ethos-NMS
    monitoring_spec:
      path: ".ethos/monitoring_spec_stage.yml"
  - name: vectordbservice-prd
    type: Ethos-NMS
    monitoring_spec:
      path: ".ethos/monitoring_spec_prod.yml"
# Mandatory
# List of teams and their associated roles.
# There should be at least one item in this array.
# Only pre-defined roles can be used. The pre-defined roles are:
#   1. ethos_deployments_admin - Grants admin permissions on Moonbeam and Flight Director.
#   2. ethos_deployments_deployer - Grants deploy permissions on Moonbeam and Flight Director.
# At least one team should have 'ethos_deployments_admin' role.
# The person onboarding or re-onboarding the service should be part of atleast one team with 'ethos_deployments_admin' role.
# 'Mandatory' for new services getting onboarded.
# 'Optional' for existing services getting re-onboarded, for backward compatibility reasons.
team_access_control:
  -
    # Mandatory
    # Name of one of Github teams attached with this repository.
    name: content-auditor-admin
    # Mandatory
    # Array of roles. Allowed value are one or more of the pre-defined roles mentioned above.
    roles: [ethos_deployments_admin]
  -
    name: content-auditor-deploy
    # Default value for role is 'ethos_deployments_deployer'.
    # roles: [ethos_deployments_deployer]

secret_providers:
  - name: cst_vault

images:
  - id: vectordbserviceimg

containers:
  - id: vectordbservice
    image_id: vectordbserviceimg
    # Allowed values: DB, Cache, Worker, Router, AppServer, WebServer, DockerHost, LB, other (in case the none of listed values applies).
    class: WebServer
    # See https://git.corp.adobe.com/adobe-platform/service-spec/blob/60b4cca08bacb91657c20761939716b93f361a9a/spec.yaml#L141
    arch_path: Other.ContentAuditor.vectordbservice

environments:
  - name: Stage
    cluster_type: STAGE
    rollback_on_failure: true
    cluster_rbac_ldap:
      read:
        - GRP-G11NHARMNBIAS
    monitoring:
      - name: vectordbservice-stg
    containers:
      - id: vectordbservice
        topology: inet
        inet_port: 6006
        health_check:
          path: /health
          grace_period: 120
        cpus: 4
        mem: 24576
        gpus: 4
        scaling:
          min_containers: 1
          max_containers: 1
          rps_max_throughput: 12
          rps_low_watermark: 30
          rps_high_watermark: 60
        runtime_env_vars: 
          - key: REPLACE_NEWRELIC_APP 
            field: vectordbservice-stage
          - key: REPLACE_NEWRELIC_LICENSE 
            secret_ref: cloudtech_g11n/contentauditor/stage 
            field: NEW_RELIC_LICENSE_KEY
          - key: SPLUNK_TOKEN
            secret_ref: cloudtech_g11n/contentauditor/stage 
            field: SPLUNK_TOKEN
        
        # By default, Glider creates services that are only accessible via Adobe egress IPs.
        # If you wish to change this behavior, see https://git.corp.adobe.com/adobe-platform/service-spec/blob/f7d7969177b9eddad9b7bc991f4fbbab506b5fd8/spec.yaml#L341-L352
        access_level: corp
        load_balancing:
          idle_timeout: 120


  - name: Production
    cluster_type: PROD
    rollback_on_failure: true
    cluster_rbac_ldap:
      read:
        - GRP-G11NHARMNBIAS
    monitoring:
      - name: vectordbservice-prd
    containers:
      - id: vectordbservice
        topology: inet
        inet_port: 6006
        health_check:
          path: /health
          grace_period: 120
        cpus: 4
        mem: 24576
        gpus: 4
        scaling:
          min_containers: 1
          max_containers: 4
          rps_max_throughput: 12
          rps_low_watermark: 30
          rps_high_watermark: 60
        runtime_env_vars: 
          - key: REPLACE_NEWRELIC_APP 
            field: vectordbservice-prod
          - key: REPLACE_NEWRELIC_LICENSE 
            secret_ref: cloudtech_g11n/contentauditor/prod 
            field: NEW_RELIC_LICENSE_KEY
          - key: SPLUNK_TOKEN 
            secret_ref: cloudtech_g11n/contentauditor/prod 
            field: SPLUNK_TOKEN
        
        # By default, Glider creates services that are only accessible via Adobe egress IPs.
        # If you wish to change this behavior, see https://git.corp.adobe.com/adobe-platform/service-spec/blob/f7d7969177b9eddad9b7bc991f4fbbab506b5fd8/spec.yaml#L341-L352
        access_level: public
        load_balancing:
          idle_timeout: 120
